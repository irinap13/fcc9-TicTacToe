$(document).ready(function(){var e=[["c1","c2","c3"],["c4","c5","c6"],["c7","c8","c9"],["c1","c4","c7"],["c2","c5","c8"],["c3","c6","c9"],["c1","c5","c9"],["c3","c5","c7"]],t=[],n=[],a="",o="",s=[],c=[],r=[],i=[],l=!1,u="user";$(".player-info .btn-player").on("click",function(){f.reset(),$(".player-info .btn-player").removeClass("btn-primary chosen").addClass("computer"),$(this).removeClass("computer").addClass("btn-primary chosen")}),$("#start_game").on("click",function(){"user"===u?u="ai":"ai"===u&&(u="user"),f.reset(),f.start()});var f={reset:function(){$(".game-row .col-xs-4 span").text("").removeClass("busy pl1 pl2").css("color","#666"),$("#info_text h3").text(""),t=[],n=[],a="",o="",s=[],c=[],r=[],i=[],l=!1},start:function(){var e="";a=$(".player-info .chosen").text(),o=$(".player-info .computer").text(),"ai"===u?f.computerAI():$(".game-row .col-xs-4").on("click",function(){return $(this).find("span").hasClass("busy")||l?!1:(e=$(this).attr("id"),$("#"+e+" span").text(a).addClass("busy pl1"),f.computerAI(),void 0)})},computerAI:function(){function e(e,t){return Math.floor(Math.random()*(t-e+1))+e}var t=f.evaluateBoard(),n=[],a=[];if(t.forEach(function(e){"string"!=typeof e&&(n.push(e),a=n.reduce(function(e,t){return e.concat(t)}))}),1===a.length)f.computerMove(a[0]);else{var o=f.getBusyCells(),s=[],c=[];$(".col-xs-4").each(function(e){s.push(this.id)}),c=0===a.length?f.cleanMoves(o,s):f.cleanMoves(o,a);var r=e(0,c.length-1);f.computerMove(c[r])}},computerMove:function(e){l||setTimeout(function(){$("#"+e+" span").text(o).addClass("busy pl2"),f.evaluateBoard()},500)},getBusyCells:function(){return c=[],$(".busy").each(function(){c.push($(this).closest("div")[0].id)}),c},evaluateBoard:function(){return r=[],i=[],$("span.busy.pl1").each(function(){r.push($(this).closest("div")[0].id)}),$("span.busy.pl2").each(function(){i.push($(this).closest("div")[0].id)}),f.cleanMoves(f.getBusyCells(),f.movesToWin())},movesToWin:function(){if(t=[],n=[],e.forEach(function(e){var a=0,o=0;r.forEach(function(t){e.indexOf(t)>-1&&a++}),t.push(a),i.forEach(function(t){e.indexOf(t)>-1&&o++}),n.push(o)}),n.indexOf(2)>-1)for(var a=[],o=0;o<n.length;o++)2===n[o]&&a.push(o);else if(t.indexOf(2)>-1)for(var a=[],s=0;s<t.length;s++)2===t[s]&&a.push(s);else{for(var a=[],c=0;c<n.length;c++)1===n[c]&&a.push(c);for(var u=0;u<t.length;u++)1===t[u]&&a.push(u)}n.indexOf(3)>-1&&e[n.indexOf(3)].forEach(function(e){$("#"+e+" span").css("color","green"),l=!0}),t.indexOf(3)>-1&&e[t.indexOf(3)].forEach(function(e){$("#"+e+" span").css("color","green"),l=!0}),9!==$(".busy").length||l||($(".busy").css("color","red"),$("#info_text h3").text("Game over, no one has won!"));var h=[];a.forEach(function(t){h.push(e[t])});var p=[];return h.forEach(function(e){p.push(f.cleanMoves(f.getBusyCells(),e))}),p},cleanMoves:function(e,t){for(var n=[],a=0;a<t.length;a++)e.indexOf(t[a])<0&&n.push(t[a]);return n}}});
