$(document).ready(function(){var t=[["c1","c2","c3"],["c4","c5","c6"],["c7","c8","c9"],["c1","c4","c7"],["c2","c5","c8"],["c3","c6","c9"],["c1","c5","c9"],["c3","c5","c7"]],e=[],n=[],a="",o="",s=[],c=[],r=[],i=[],l=!1,u="user";$(".player-info .btn-player").on("click",function(){d.reset(),$(".player-info .btn-player").removeClass("btn-primary chosen").addClass("computer"),$(this).removeClass("computer").addClass("btn-primary chosen")}),$("#start_game").on("click",function(){"user"===u?u="ai":"ai"===u&&(u="user"),d.reset(),d.start()});var d={reset:function(){$(".game-row .col-xs-4 span").text("").removeClass("busy pl1 pl2").css("color","#666"),$("#info_text h3").text(""),e=[],n=[],a="",o="",s=[],c=[],r=[],i=[],l=!1},start:function(){var t="";a=$(".player-info .chosen").text(),o=$(".player-info .computer").text(),"ai"===u?d.computerAI():$(".game-row .col-xs-4").on("click",function(){return $(this).find("span").hasClass("busy")||l?!1:(t=$(this).attr("id"),$("#"+t+" span").text(a).addClass("busy pl1"),d.computerAI(),void 0)})},computerAI:function(){function t(t,e){return Math.floor(Math.random()*(e-t+1))+t}var e=d.evaluateBoard(),n=[],a=[];if(e.forEach(function(t){"string"!=typeof t&&(n.push(t),a=n.reduce(function(t,e){return t.concat(e)}))}),1===a.length)d.computerMove(a[0]);else{var o=d.getBusyCells(),s=[],c=[];$(".col-xs-4").each(function(t){s.push(this.id)}),c=0===a.length?d.cleanMoves(o,s):d.cleanMoves(o,a);var r=t(0,c.length-1);d.computerMove(c[r])}},computerMove:function(t){l||setTimeout(function(){$("#"+t+" span").text(o).addClass("busy pl2"),d.evaluateBoard()},500)},getBusyCells:function(){return c=[],$(".busy").each(function(){c.push($(this).closest("div")[0].id)}),c},evaluateBoard:function(){return r=[],i=[],$("span.busy.pl1").each(function(){r.push($(this).closest("div")[0].id)}),$("span.busy.pl2").each(function(){i.push($(this).closest("div")[0].id)}),d.cleanMoves(d.getBusyCells(),d.movesToWin())},movesToWin:function(){if(e=[],n=[],t.forEach(function(t){var a=0,o=0;r.forEach(function(e){t.indexOf(e)>-1&&a++}),e.push(a),i.forEach(function(e){t.indexOf(e)>-1&&o++}),n.push(o)}),n.indexOf(2)>-1)for(var a=[],o=0;o<n.length;o++)2===n[o]&&a.push(o);else if(e.indexOf(2)>-1)for(var a=[],s=0;s<e.length;s++)2===e[s]&&a.push(s);else{for(var a=[],c=0;c<n.length;c++)1===n[c]&&a.push(c);for(var u=0;u<e.length;u++)1===e[u]&&a.push(u)}n.indexOf(3)>-1&&t[n.indexOf(3)].forEach(function(t){$("#"+t+" span").css("color","green"),l=!0}),e.indexOf(3)>-1&&t[e.indexOf(3)].forEach(function(t){$("#"+t+" span").css("color","green"),l=!0}),9!==$(".busy").length||l||($(".busy").css("color","red"),$("#info_text h3").text("Game over, no one has won!"));var h=[];a.forEach(function(e){h.push(t[e])});var f=[];return h.forEach(function(t){f.push(d.cleanMoves(d.getBusyCells(),t))}),f},cleanMoves:function(t,e){for(var n=[],a=0;a<e.length;a++)t.indexOf(e[a])<0&&n.push(e[a]);return n}}});
